# F2.3.4 Team Workspaces

## Status
- Phase: 6 Collaboration
- Feature ID: F2.3.4
- Priority: P1
- Status: In Progress

## Goal
Deliver a complete team workspace surface built on top of organization data, including membership roles, invitations, workspace settings, shared templates, activity tracking, shared API keys, usage quotas, audit logs, and workspace switching.

## Scope
1. Strapi content model for workspace collaboration data.
2. Next.js API routes that enforce workspace context.
3. Redux workspace state for dashboard and sidebar UX.
4. Team workspace UI integrated into dashboard organization management.
5. Tests for CRUD and policy-sensitive workspace flows.

## Functional Requirements
1. Workspace model includes name, description, avatar.
2. Invitation flow supports send, accept, decline.
3. Roles enforce `admin`, `editor`, `viewer` behavior.
4. Team settings allow editing metadata and notification preferences.
5. Workspace templates are shared across members.
6. Activity dashboard shows recent edits/comments/generation events.
7. Sidebar supports switching among user workspaces.
8. Workspace-level AI API keys are managed in one place.
9. Workspace quota limits monthly AI generations and tracks usage.
10. Audit viewer lists permission changes and member changes.

## Data Contracts
### Core workspace entities
- `organization`: workspace metadata + quota + notification preferences.
- `organization-member`: role membership (`admin|editor|viewer`).
- `organization-invite`: invite lifecycle (`pending|accepted|declined|expired`).
- `organization-template`: shared template definitions.
- `organization-activity`: workspace activity stream.
- `organization-api-key`: shared provider credentials metadata.
- `organization-audit-log`: durable audit trail.

## API Surface
- `GET /api/organizations/workspaces`
- `GET /api/organizations/:organizationId/workspace`
- `PUT /api/organizations/:organizationId/workspace`
- `GET /api/organizations/:organizationId/templates`
- `POST /api/organizations/:organizationId/templates`
- `GET /api/organizations/:organizationId/activity`
- `GET /api/organizations/:organizationId/audit-logs`
- `GET /api/organizations/:organizationId/api-keys`
- `POST /api/organizations/:organizationId/api-keys`
- `DELETE /api/organizations/:organizationId/api-keys/:apiKeyId`
- `POST /api/organizations/invites/:inviteId/respond`

## Permissions
- Admin
  - Manage settings, members, invites, quota, API keys.
- Editor
  - Create and update templates.
  - View activity/audit.
- Viewer
  - Read-only workspace access.

## Non-Functional Constraints
- Strict TypeScript, no `any`.
- No file over 300 lines.
- No placeholder UI behavior.
- Every new data path includes tests.

## Test Plan
1. Workspace list and switch updates Redux state.
2. Invite accept/decline updates invite state.
3. Role checks block forbidden write actions.
4. Templates are fetched and created in workspace scope.
5. Quota update enforces non-negative values.
6. Activity and audit endpoints map response shape correctly.
7. API key create/revoke updates local state.
