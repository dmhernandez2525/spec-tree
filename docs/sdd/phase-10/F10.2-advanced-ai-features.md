# F10.2 - Advanced AI Features

## Overview

AI model configuration, token estimation, cost calculation, prompt building for spec generation and review, response parsing, and quality scoring for SpecTree specifications.

## Architecture

```
Client/lib/ai/
  advanced-features.ts  # Models, config, token/cost estimation, prompt builders, parser, scoring
  ai-features.test.ts   # 52 tests
```

## Features

- **Model Registry**: Four preconfigured models across OpenAI and Anthropic providers with token limits and per-1k-token pricing
- **Token Estimation**: Heuristic-based estimation (~4 characters per token), rounded up
- **Cost Calculation**: Per-model cost projection based on estimated token count
- **Spec Generation Prompt**: Structured prompt builder with format options (detailed, concise, technical), optional acceptance criteria and estimates, context injection
- **Review Prompt**: Builds evaluation prompts with configurable quality criteria (completeness, clarity, testability, feasibility, consistency) and 1-10 scoring instructions
- **Response Parsing**: Extracts JSON from raw text, markdown code blocks, or embedded JSON structures; supports text and markdown passthrough
- **Quality Scoring**: Weighted 0-100 score based on section completeness (title 15pts, description 25pts, requirements 20pts, acceptance criteria 20pts, estimates/dependencies/risks/assumptions 5pts each)

## Available Models

| Model           | Provider  | Max Tokens | Cost/1k Tokens |
|-----------------|-----------|------------|----------------|
| GPT-4           | OpenAI    | 8192       | $0.030         |
| GPT-3.5 Turbo   | OpenAI    | 4096       | $0.002         |
| Claude 3 Opus   | Anthropic | 4096       | $0.015         |
| Claude 3 Sonnet | Anthropic | 4096       | $0.003         |

## Default Generation Config

```
model: gpt-4, temperature: 0.7, maxTokens: 4096, topP: 1,
frequencyPenalty: 0, presencePenalty: 0
```

## Test Coverage

52 tests: estimateTokenCount (5), estimateCost (7), buildSpecGenerationPrompt (9), buildReviewPrompt (5), parseAIResponse (7), calculateQualityScore (8), AVAILABLE_MODELS (5), DEFAULT_GENERATION_CONFIG (6).
