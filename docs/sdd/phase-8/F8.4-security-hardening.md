# F8.4 - Security Hardening

## Overview

Defense-in-depth security toolkit covering input sanitization, Content Security Policy, client-side rate limiting, role-based access control, CSRF protection, and security header configuration.

## Architecture

```
Client/lib/security/
  input-sanitizer.ts    # XSS/injection prevention (HTML, URL, SQL, filename)
  csp-config.ts         # Content Security Policy builder and validator
  rate-limit-client.ts  # Client-side rate limiting per endpoint type
  auth-guard.ts         # Role-based permissions and session validation
  csrf-protection.ts    # Double-submit cookie CSRF tokens
  security-headers.ts   # HTTP security header configuration
  security.test.ts      # 138 tests covering all modules
```

## Modules

| Module | Purpose |
|--------|---------|
| Input Sanitizer | HTML tag stripping, safe markdown filtering, HTML entity escaping, URL scheme validation (blocks javascript:/data:), filename sanitization, recursive object sanitization |
| CSP Config | Strict default policy, nonce generation, policy validation (warns on unsafe-inline/eval), policy merging |
| Rate Limit Client | Per-endpoint configs (API: 60/min, AI: 10/min, Export: 5/min), window-based throttling with backoff |
| Auth Guard | Role-permission mapping (viewer/editor/admin), session validation, token expiry checks, custom AuthError class |
| CSRF Protection | Token generation, timing-safe validation, double-submit cookie middleware pattern |
| Security Headers | X-Content-Type-Options, X-Frame-Options, Referrer-Policy, Permissions-Policy, HSTS, validation for missing headers |

## Default Rate Limits

| Endpoint | Max Requests | Window |
|----------|-------------|--------|
| API | 60 | 1 minute |
| AI Generation | 10 | 1 minute |
| Export | 5 | 1 minute |

## Role Permissions

| Role | Permissions |
|------|------------|
| Viewer | read |
| Editor | read, write, export |
| Admin | read, write, admin, delete, export, manage-users |

## Test Coverage

138 tests: input-sanitizer (49), csp-config (16), rate-limit-client (12), auth-guard (18), csrf-protection (14), security-headers (12).
