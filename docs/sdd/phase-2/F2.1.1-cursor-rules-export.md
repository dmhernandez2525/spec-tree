# Software Design Document: Cursor Rules Export

## Metadata

| Field | Value |
|-------|-------|
| **Feature ID** | F2.1.1 |
| **Status** | Ready |
| **Created** | 2026-01-17 |
| **Last Updated** | 2026-01-17 |
| **Author** | Daniel Hernandez |
| **Assignee** | TBD |
| **Branch** | `feat/F2.1.1-cursor-rules-export` |
| **PR** | N/A |
| **Phase** | 2 |
| **Priority** | P1 |
| **Estimated Effort** | 2 days |

---

## 1. Overview

### 1.1 Brief Description
Enable users to export their Spec Tree project specifications as Cursor-compatible `.cursor/rules/` files. This allows developers using Cursor IDE to have AI-assisted coding that follows their project's specific conventions, tech stack, and patterns.

### 1.2 Business Value
- **Immediate AI improvement**: Cursor users report 1.5-2x faster productivity with proper rules
- **Key differentiator**: Position Spec Tree as the upstream source of truth for AI coding tools
- **Low effort, high impact**: Simple export generates significant user value
- **Validates vision**: First of many AI tool integrations proving Spec Tree's value proposition

### 1.3 Success Metrics
- Users can export Cursor rules in <5 seconds
- 80%+ of exported rules are used without modification
- User feedback indicates improved Cursor code generation quality

---

## 2. User Story

**As a** developer using Cursor IDE,
**I want** to export my Spec Tree project specifications as Cursor rules,
**So that** Cursor generates code that follows my project's conventions and understands my current context.

### 2.1 User Personas Affected
- [x] Product Manager
- [x] Developer
- [x] Tech Lead
- [ ] Designer
- [ ] Stakeholder
- [ ] Admin

---

## 3. Acceptance Criteria

### 3.1 Functional Requirements

- [ ] **AC-1:** User can access "Export to Cursor" from project toolbar/menu
- [ ] **AC-2:** Export generates `.cursor/rules/` directory structure with MDC files
- [ ] **AC-3:** Rules include project tech stack (framework, language, styling, state management)
- [ ] **AC-4:** Rules include naming conventions (components, hooks, types, files)
- [ ] **AC-5:** Rules include code patterns (reference existing files as examples)
- [ ] **AC-6:** Rules include current feature/task context when exported from work item
- [ ] **AC-7:** User can preview rules before downloading
- [ ] **AC-8:** User can copy rules to clipboard or download as zip
- [ ] **AC-9:** Export handles projects without tech stack configured (prompts user)
- [ ] **AC-10:** Rules file follows Cursor's expected MDC format with frontmatter

### 3.2 Non-Functional Requirements

- [ ] **NFR-1:** Performance - Export completes in <3 seconds for projects with 100 work items
- [ ] **NFR-2:** Accessibility - Export button and dialog are keyboard navigable
- [ ] **NFR-3:** Security - No sensitive data (API keys, passwords) included in export
- [ ] **NFR-4:** Compatibility - Output tested with Cursor version 0.40+

### 3.3 Edge Cases

- [ ] **EC-1:** Project has no tech stack configured - Show prompt to configure or use defaults
- [ ] **EC-2:** Export from task level - Include full parent context (story, feature, epic)
- [ ] **EC-3:** Very long descriptions - Truncate with link to full spec in Spec Tree
- [ ] **EC-4:** Special characters in names - Escape properly for MDC format

---

## 4. Technical Design

### 4.1 Architecture Overview

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          Export Flow                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  User clicks "Export to Cursor"                                         │
│         │                                                               │
│         ▼                                                               │
│  ┌─────────────────┐                                                   │
│  │ CursorExportBtn │ ─── Opens export dialog                           │
│  └────────┬────────┘                                                   │
│           │                                                            │
│           ▼                                                            │
│  ┌─────────────────┐                                                   │
│  │ ExportDialog    │ ─── Shows preview, options                        │
│  └────────┬────────┘                                                   │
│           │                                                            │
│           ▼                                                            │
│  ┌─────────────────┐     ┌─────────────────┐                          │
│  │ cursor-export.ts│ ──▶ │ rules-template.ts│                          │
│  │ (generates)     │     │ (formats)        │                          │
│  └────────┬────────┘     └─────────────────┘                          │
│           │                                                            │
│           ▼                                                            │
│  ┌─────────────────┐                                                   │
│  │ Output:         │                                                   │
│  │ .cursor/rules/  │                                                   │
│  │ ├── project.mdc │                                                   │
│  │ └── feature.mdc │ (if exporting from work item)                    │
│  └─────────────────┘                                                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.2 Data Models

```typescript
// Export configuration
interface CursorExportConfig {
  includeProjectRules: boolean;
  includeFeatureContext: boolean;
  includeTechStack: boolean;
  includePatterns: boolean;
  includeNamingConventions: boolean;
}

// Project information for export
interface ProjectExportData {
  name: string;
  description: string;
  techStack: TechStackConfig;
  conventions: NamingConventions;
  patterns: CodePattern[];
}

interface TechStackConfig {
  framework: string;       // e.g., "Next.js 14"
  language: string;        // e.g., "TypeScript (strict mode)"
  styling: string;         // e.g., "Tailwind CSS"
  stateManagement: string; // e.g., "Zustand + React Query"
  testing: string;         // e.g., "Vitest + React Testing Library"
  ui: string;              // e.g., "shadcn/ui + Radix primitives"
}

interface NamingConventions {
  components: string;      // e.g., "PascalCase in src/components/"
  hooks: string;           // e.g., "camelCase with 'use' prefix"
  types: string;           // e.g., "PascalCase with 'interface' keyword"
  files: string;           // e.g., "kebab-case for non-components"
  constants: string;       // e.g., "SCREAMING_SNAKE_CASE"
}

interface CodePattern {
  name: string;
  description: string;
  referenceFile: string;
  usage: string;
}

// Feature context for export
interface FeatureExportData {
  epic?: {
    title: string;
    goal: string;
    context: string;
  };
  feature?: {
    title: string;
    description: string;
    acceptanceCriteria: string[];
  };
  userStory?: {
    title: string;
    role: string;
    action: string;
    goal: string;
    acceptanceCriteria: string[];
  };
  task?: {
    title: string;
    details: string;
    priority: string;
  };
}

// Output format
interface CursorRulesOutput {
  projectRules: string;  // MDC formatted project rules
  featureRules?: string; // MDC formatted feature context (optional)
}
```

### 4.3 API Endpoints

No new API endpoints required. Export is client-side only using existing Redux state.

### 4.4 State Management

```typescript
// Add to export slice (new)
interface ExportState {
  cursorExportConfig: CursorExportConfig;
  lastExport: {
    type: 'cursor' | 'copilot' | 'devin' | null;
    timestamp: string | null;
  };
}

const initialState: ExportState = {
  cursorExportConfig: {
    includeProjectRules: true,
    includeFeatureContext: true,
    includeTechStack: true,
    includePatterns: true,
    includeNamingConventions: true,
  },
  lastExport: {
    type: null,
    timestamp: null,
  },
};
```

### 4.5 UI Components

| Component | Purpose | Props |
|-----------|---------|-------|
| `CursorExportButton` | Trigger export dialog | `workItemId?: string` |
| `CursorExportDialog` | Configure and preview export | `isOpen, onClose, config, data` |
| `CursorRulesPreview` | Show preview of generated rules | `rules: string` |
| `ExportOptionsForm` | Configure export options | `config, onChange` |

### 4.6 Implementation Steps

1. [ ] Create `cursor-export.ts` utility with main export logic
2. [ ] Create `rules-template.ts` with MDC formatting functions
3. [ ] Create `CursorExportButton` component
4. [ ] Create `CursorExportDialog` component with preview
5. [ ] Create `CursorRulesPreview` component with syntax highlighting
6. [ ] Integrate export button into project toolbar
7. [ ] Integrate export button into work item actions menu
8. [ ] Add clipboard copy functionality
9. [ ] Add zip download functionality
10. [ ] Add export configuration persistence

---

## 5. Files Affected

### 5.1 New Files

| File Path | Purpose |
|-----------|---------|
| `components/spec-tree/lib/export/cursor-export.ts` | Core export logic |
| `components/spec-tree/lib/templates/cursor-rules-template.ts` | MDC formatting |
| `components/spec-tree/components/export/CursorExportButton.tsx` | Export trigger button |
| `components/spec-tree/components/export/CursorExportDialog.tsx` | Export configuration dialog |
| `components/spec-tree/components/export/CursorRulesPreview.tsx` | Preview component |
| `lib/store/export-slice.ts` | Export state management |

### 5.2 Modified Files

| File Path | Changes |
|-----------|---------|
| `components/spec-tree/components/builder/BuilderToolbar.tsx` | Add export button |
| `components/spec-tree/components/epic/EpicActions.tsx` | Add export to menu |
| `components/spec-tree/components/feature/FeatureActions.tsx` | Add export to menu |
| `components/spec-tree/components/user-story/UserStoryActions.tsx` | Add export to menu |
| `components/spec-tree/components/task/TaskActions.tsx` | Add export to menu |
| `lib/store/index.ts` | Add export slice |

---

## 6. Testing Strategy

### 6.1 Unit Tests

| Test | Description | File |
|------|-------------|------|
| `generateCursorRules` | Tests rule generation with various inputs | `cursor-export.test.ts` |
| `formatMDC` | Tests MDC format output | `cursor-rules-template.test.ts` |
| `sanitizeContent` | Tests special character handling | `cursor-export.test.ts` |
| `truncateDescription` | Tests long content truncation | `cursor-export.test.ts` |

### 6.2 Integration Tests

| Test | Description | File |
|------|-------------|------|
| `CursorExportDialog` | Tests full export flow | `CursorExportDialog.test.tsx` |
| `ExportWithContext` | Tests export from work item | `cursor-export.integration.test.ts` |

### 6.3 E2E Tests

| Test | Description | File |
|------|-------------|------|
| `cursor-export` | Full export flow from UI | `cursor-export.spec.ts` |

### 6.4 Manual Testing Checklist

- [ ] Export from project level generates valid rules
- [ ] Export from task level includes full parent context
- [ ] Preview matches downloaded content
- [ ] Clipboard copy works
- [ ] Zip download works
- [ ] Exported rules work in Cursor (manual verification)
- [ ] Mobile viewport shows export option
- [ ] Keyboard navigation works throughout dialog

---

## 7. Dependencies

### 7.1 Depends On

| Feature ID | Name | Status |
|------------|------|--------|
| - | JSON export utilities | Complete |
| - | Work item hierarchy | Complete |

### 7.2 Blocks

| Feature ID | Name |
|------------|------|
| F2.1.2 | Cursor Rules import |
| F3.1.1 | MCP Server (uses similar format) |

### 7.3 External Dependencies

| Package | Version | Purpose |
|---------|---------|---------|
| `jszip` | `^3.10.0` | Create zip download |
| `prismjs` | `^1.29.0` | Syntax highlighting in preview (if not already installed) |

---

## 8. Risks & Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Cursor changes rules format | Medium | High | Version rules, monitor Cursor releases |
| Users don't have tech stack configured | High | Medium | Prompt to configure, provide sensible defaults |
| Generated rules too generic | Medium | Medium | Include specific patterns from codebase |
| Large projects slow export | Low | Medium | Optimize generation, add progress indicator |

---

## 9. Rollout Plan

### 9.1 Feature Flag
- Flag name: `feature_cursor_export`
- Default: `true` (no flag needed, ship directly)
- Enable for: All users

### 9.2 Rollout Phases
1. **Internal testing**: 1 day
2. **Beta users**: N/A (ship directly)
3. **General availability**: Immediately after merge

---

## 10. Definition of Done

- [ ] All acceptance criteria met
- [ ] All tests passing
- [ ] Code reviewed and approved
- [ ] Documentation updated (ROADMAP.md, README if needed)
- [ ] No TypeScript errors
- [ ] No ESLint warnings
- [ ] Accessibility tested (keyboard nav, screen reader)
- [ ] Performance acceptable (<3s for large projects)
- [ ] Manual testing with actual Cursor IDE
- [ ] PR merged to main

---

## 11. References

- [Cursor Rules Documentation](https://cursor.sh/docs/rules) (approximate URL)
- [MDC Format Specification](https://cursor.sh/docs/mdc)
- Research: Cursor users report `.cursorrules` as essential for productivity
- Competitor analysis: No existing tool generates Cursor rules from specs

---

## 12. Changelog

| Date | Author | Change |
|------|--------|--------|
| 2026-01-17 | Daniel Hernandez | Initial draft |

---

## Cursor Rules Output Format

### Project Rules File: `.cursor/rules/project.mdc`

```markdown
---
title: [App Name] Project Rules
description: AI coding rules generated by Spec Tree
version: 1.0
generated: 2026-01-17
source: https://spectree.dev
---

# Project: [App Name]

## Overview
[App description from Spec Tree]

## Tech Stack
- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript (strict mode enabled)
- **Styling**: Tailwind CSS
- **UI Components**: shadcn/ui + Radix primitives
- **State Management**: Zustand for client state, React Query for server state
- **Forms**: React Hook Form with Zod validation
- **Testing**: Vitest + React Testing Library + Playwright

## Code Style & Conventions

### File Organization
- Components: `src/components/` (PascalCase)
- Hooks: `src/hooks/` (camelCase with `use` prefix)
- Types: `src/types/` (PascalCase with `interface`)
- Utils: `src/lib/` (camelCase)

### Naming Conventions
- Components: `PascalCase` (e.g., `DateRangePicker.tsx`)
- Hooks: `useCamelCase` (e.g., `useDateFilter.ts`)
- Types: `PascalCase` (e.g., `interface DateRange`)
- Constants: `SCREAMING_SNAKE_CASE`
- CSS classes: Tailwind utilities with `cn()` for conditionals

### Code Patterns

#### Component Pattern
Follow the pattern in: `src/components/ui/button.tsx`
- Export named component
- Use `forwardRef` for DOM element components
- Define props interface above component
- Use `cn()` for className merging

#### Hook Pattern
Follow the pattern in: `src/hooks/use-media-query.ts`
- Single responsibility
- Return object with named properties
- Handle loading and error states

#### API Pattern
Follow the pattern in: `src/lib/api/strapi-service.ts`
- Centralized API client
- Type-safe request/response
- Error handling with custom errors

## Architecture Decisions
- Server components by default, client components when needed
- Collocate tests with source files
- Use barrel exports sparingly
- Prefer composition over inheritance

## DO NOT
- Use `any` type
- Use `@ts-ignore` or `@ts-nocheck`
- Use inline styles (use Tailwind)
- Create components > 300 lines (split them)
- Use default exports (use named exports)
```

### Feature Context File: `.cursor/rules/current-feature.mdc`

```markdown
---
title: Current Feature Context
description: Active work item context for AI assistance
generated: 2026-01-17
expires: 2026-01-24
---

# Current Work: [Feature/Task Name]

## Hierarchy
- **Epic**: [Epic title]
- **Feature**: [Feature title]
- **Story**: [Story title]
- **Task**: [Task title]

## User Story
As a [role], I want [action] so that [benefit].

## Acceptance Criteria
- [ ] [Criterion 1]
- [ ] [Criterion 2]
- [ ] [Criterion 3]

## Technical Context
- **Primary file**: `src/components/orders/DateRangePicker.tsx`
- **Related files**:
  - `src/hooks/useDateFilter.ts`
  - `src/pages/orders/index.tsx`
- **Pattern reference**: Follow `src/components/ui/calendar.tsx`

## Implementation Notes
[Any technical notes from the task]

## Constraints
- Must use existing date-fns for date manipulation
- Must be accessible (keyboard nav, ARIA)
- Must support dark mode

## Full Specification
View complete spec at: [Spec Tree URL]
```

---

## AI Agent Export Format

<details>
<summary>Click to expand AI-ready specification</summary>

```json
{
  "specVersion": "1.0",
  "generatedBy": "SpecTree",
  "feature": {
    "id": "F2.1.1",
    "title": "Cursor Rules Export",
    "type": "frontend",
    "context": {
      "project": "Spec Tree",
      "phase": 2,
      "techStack": ["Next.js 14", "TypeScript", "Tailwind", "Strapi"],
      "existingPatterns": "components/spec-tree/lib/export/"
    },
    "specification": {
      "userStory": "As a developer using Cursor IDE, I want to export my Spec Tree project specifications as Cursor rules, so that Cursor generates code that follows my project's conventions.",
      "acceptanceCriteria": [
        "User can access Export to Cursor from project toolbar",
        "Export generates .cursor/rules/ directory with MDC files",
        "Rules include tech stack, naming conventions, and patterns",
        "User can preview rules before downloading",
        "Export handles projects without tech stack configured"
      ],
      "filesAffected": [
        "components/spec-tree/lib/export/cursor-export.ts",
        "components/spec-tree/components/export/CursorExportButton.tsx",
        "components/spec-tree/components/export/CursorExportDialog.tsx"
      ],
      "testRequirements": [
        "Unit tests for rule generation",
        "Integration tests for export dialog",
        "E2E test for full export flow"
      ]
    },
    "constraints": {
      "mustUse": ["jszip for downloads", "existing shadcn components"],
      "mustNotUse": ["external API calls for export"],
      "performanceTarget": "Export completes in <3 seconds"
    }
  }
}
```

</details>
