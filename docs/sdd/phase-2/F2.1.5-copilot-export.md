# Software Design Document: GitHub Copilot Export

## Metadata

| Field | Value |
|-------|-------|
| **Feature ID** | F2.1.5 |
| **Status** | Ready |
| **Created** | 2026-01-17 |
| **Last Updated** | 2026-01-17 |
| **Author** | Daniel Hernandez |
| **Assignee** | TBD |
| **Branch** | `feat/F2.1.5-copilot-export` |
| **PR** | N/A |
| **Phase** | 2 |
| **Priority** | P1 |
| **Estimated Effort** | 2 days |

---

## 1. Overview

### 1.1 Brief Description
Enable users to export Spec Tree specifications in GitHub Copilot-compatible formats: `copilot-instructions.md` for repository-level instructions and WRAP (What, Requirements, Actual files, Patterns) format for individual GitHub Issues that Copilot Coding Agent can process.

### 1.2 Business Value
- **Enterprise reach**: GitHub Copilot is the enterprise standard with 100M+ users
- **Coding Agent compatibility**: Exported issues can be assigned to `@copilot` for autonomous implementation
- **Workflow integration**: Fits naturally into GitHub-centric development workflows
- **Low effort, high impact**: Simple export generates significant user value

### 1.3 Success Metrics
- Users can export Copilot instructions in <5 seconds
- Users can export work items as WRAP issues in <2 seconds
- Exported issues work with GitHub Copilot Coding Agent without modification

---

## 2. User Story

**As a** developer using GitHub Copilot,
**I want** to export my Spec Tree specifications as Copilot-compatible formats,
**So that** Copilot understands my project context and can autonomously implement tasks from exported issues.

### 2.1 User Personas Affected
- [x] Product Manager
- [x] Developer
- [x] Tech Lead
- [ ] Designer
- [ ] Stakeholder
- [ ] Admin

---

## 3. Acceptance Criteria

### 3.1 Functional Requirements

- [ ] **AC-1:** User can export project as `.github/copilot-instructions.md`
- [ ] **AC-2:** User can export individual tasks as WRAP format issues
- [ ] **AC-3:** WRAP format includes: What, Requirements, Actual files, Patterns
- [ ] **AC-4:** Export includes tech stack and coding conventions
- [ ] **AC-5:** User can copy issue content to clipboard for GitHub issue creation
- [ ] **AC-6:** User can bulk export multiple tasks as separate issues
- [ ] **AC-7:** Export includes test requirements in Requirements section
- [ ] **AC-8:** User can preview content before exporting
- [ ] **AC-9:** Export includes labels suggestion for Copilot (e.g., `copilot`, `ai-ready`)
- [ ] **AC-10:** Instructions file follows GitHub's expected format

### 3.2 Non-Functional Requirements

- [ ] **NFR-1:** Performance - Export completes in <2 seconds per item
- [ ] **NFR-2:** Accessibility - Export button and dialog are keyboard navigable
- [ ] **NFR-3:** Security - No API keys or secrets included in export
- [ ] **NFR-4:** Compatibility - Works with GitHub Issues markdown format

### 3.3 Edge Cases

- [ ] **EC-1:** Task has no technical details - Include placeholder with guidance
- [ ] **EC-2:** Bulk export of 50+ items - Show progress indicator
- [ ] **EC-3:** Very long acceptance criteria - Format as nested checklist
- [ ] **EC-4:** No pattern files referenced - Suggest common patterns

---

## 4. Technical Design

### 4.1 Architecture Overview

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          Export Flow                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  User clicks "Export to Copilot"                                        │
│         │                                                               │
│         ├─────────────────────────────────────────────┐                │
│         │                                             │                │
│         ▼                                             ▼                │
│  ┌─────────────────┐                    ┌─────────────────┐           │
│  │ Instructions    │                    │ WRAP Issue      │           │
│  │ Export          │                    │ Export          │           │
│  └────────┬────────┘                    └────────┬────────┘           │
│           │                                      │                     │
│           ▼                                      ▼                     │
│  ┌─────────────────┐                    ┌─────────────────┐           │
│  │ copilot-        │                    │ wrap-template.ts│           │
│  │ instructions.md │                    │ (formats WRAP)  │           │
│  └─────────────────┘                    └────────┬────────┘           │
│                                                  │                     │
│                                                  ▼                     │
│                                         ┌─────────────────┐           │
│                                         │ Output:         │           │
│                                         │ ## What         │           │
│                                         │ ## Requirements │           │
│                                         │ ## Actual files │           │
│                                         │ ## Patterns     │           │
│                                         └─────────────────┘           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.2 Data Models

```typescript
// Export configuration
interface CopilotExportConfig {
  exportType: 'instructions' | 'wrap-issue' | 'both';
  includeTestRequirements: boolean;
  includeLabels: boolean;
  includeParentContext: boolean;
}

// WRAP Issue format
interface WRAPIssue {
  title: string;
  what: string;           // Clear description of desired outcome
  requirements: string[]; // Acceptance criteria as checklist
  actualFiles: FileReference[];
  patterns: PatternReference[];
  labels: string[];
  assignee?: '@copilot';
}

interface FileReference {
  path: string;
  purpose: string;
}

interface PatternReference {
  description: string;
  referenceFile?: string;
}

// Copilot instructions format
interface CopilotInstructions {
  projectName: string;
  projectDescription: string;
  techStack: TechStackConfig;
  conventions: CodingConventions;
  patterns: ProjectPattern[];
  doNot: string[];
}

interface CodingConventions {
  codeStyle: string[];
  fileOrganization: string[];
  naming: string[];
  testing: string[];
}

interface ProjectPattern {
  name: string;
  description: string;
  exampleFile: string;
}

// Bulk export output
interface BulkExportResult {
  issues: WRAPIssue[];
  exportedCount: number;
  skippedCount: number;
  errors: string[];
}
```

### 4.3 API Endpoints

No new API endpoints required. Export is client-side only using existing Redux state.

### 4.4 State Management

```typescript
// Add to export slice
interface CopilotExportState {
  config: CopilotExportConfig;
  bulkExportProgress: {
    total: number;
    completed: number;
    current: string;
  } | null;
}

const copilotInitialState: CopilotExportState = {
  config: {
    exportType: 'wrap-issue',
    includeTestRequirements: true,
    includeLabels: true,
    includeParentContext: true,
  },
  bulkExportProgress: null,
};
```

### 4.5 UI Components

| Component | Purpose | Props |
|-----------|---------|-------|
| `CopilotExportButton` | Trigger export dialog | `workItemId?: string, exportType` |
| `CopilotExportDialog` | Configure and preview export | `isOpen, onClose, config, data` |
| `WRAPIssuePreview` | Show preview of WRAP issue | `issue: WRAPIssue` |
| `InstructionsPreview` | Show preview of instructions | `instructions: string` |
| `BulkExportProgress` | Show progress for bulk export | `progress` |

### 4.6 Implementation Steps

1. [ ] Create `copilot-export.ts` utility with main export logic
2. [ ] Create `wrap-template.ts` with WRAP formatting functions
3. [ ] Create `instructions-template.ts` with instructions formatting
4. [ ] Create `CopilotExportButton` component
5. [ ] Create `CopilotExportDialog` component with tabs for each format
6. [ ] Create `WRAPIssuePreview` component
7. [ ] Create `InstructionsPreview` component
8. [ ] Integrate export button into project toolbar
9. [ ] Integrate export button into work item actions menu
10. [ ] Add clipboard copy functionality
11. [ ] Add bulk export with progress tracking
12. [ ] Add export configuration persistence

---

## 5. Files Affected

### 5.1 New Files

| File Path | Purpose |
|-----------|---------|
| `components/spec-tree/lib/export/copilot-export.ts` | Core export logic |
| `components/spec-tree/lib/templates/wrap-template.ts` | WRAP format generation |
| `components/spec-tree/lib/templates/copilot-instructions-template.ts` | Instructions generation |
| `components/spec-tree/components/export/CopilotExportButton.tsx` | Export trigger button |
| `components/spec-tree/components/export/CopilotExportDialog.tsx` | Export configuration dialog |
| `components/spec-tree/components/export/WRAPIssuePreview.tsx` | WRAP preview component |
| `components/spec-tree/components/export/InstructionsPreview.tsx` | Instructions preview |
| `components/spec-tree/components/export/BulkExportProgress.tsx` | Bulk progress indicator |

### 5.2 Modified Files

| File Path | Changes |
|-----------|---------|
| `components/spec-tree/components/builder/BuilderToolbar.tsx` | Add Copilot export button |
| `components/spec-tree/components/task/TaskActions.tsx` | Add "Export as Copilot Issue" |
| `lib/store/export-slice.ts` | Add Copilot export state |

---

## 6. Testing Strategy

### 6.1 Unit Tests

| Test | Description | File |
|------|-------------|------|
| `generateWRAPIssue` | Tests WRAP generation with various inputs | `copilot-export.test.ts` |
| `generateInstructions` | Tests instructions generation | `copilot-export.test.ts` |
| `formatRequirements` | Tests acceptance criteria formatting | `wrap-template.test.ts` |
| `formatFileReferences` | Tests file path formatting | `wrap-template.test.ts` |

### 6.2 Integration Tests

| Test | Description | File |
|------|-------------|------|
| `CopilotExportDialog` | Tests full export flow | `CopilotExportDialog.test.tsx` |
| `BulkExport` | Tests exporting multiple items | `copilot-export.integration.test.ts` |

### 6.3 E2E Tests

| Test | Description | File |
|------|-------------|------|
| `copilot-export` | Full export flow from UI | `copilot-export.spec.ts` |

### 6.4 Manual Testing Checklist

- [ ] Export instructions from project level
- [ ] Export single task as WRAP issue
- [ ] Bulk export 10 tasks
- [ ] Preview matches exported content
- [ ] Clipboard copy works
- [ ] Create actual GitHub issue from export (manual)
- [ ] Assign issue to @copilot and verify format works
- [ ] Keyboard navigation works throughout dialog

---

## 7. Dependencies

### 7.1 Depends On

| Feature ID | Name | Status |
|------------|------|--------|
| - | JSON export utilities | Complete |
| - | Work item hierarchy | Complete |

### 7.2 Blocks

| Feature ID | Name |
|------------|------|
| F2.4.1 | GitHub Issues export (direct API) |
| F2.4.2 | GitHub Projects sync |

### 7.3 External Dependencies

| Package | Version | Purpose |
|---------|---------|---------|
| None | - | Pure client-side implementation |

---

## 8. Risks & Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| GitHub changes WRAP format | Low | High | Monitor GitHub docs, version output |
| Copilot Coding Agent changes requirements | Medium | Medium | Follow Copilot best practices closely |
| Users create issues without proper context | Medium | Medium | Show validation warnings |
| Bulk export overwhelms browser | Low | Medium | Implement batching, progress indicator |

---

## 9. Rollout Plan

### 9.1 Feature Flag
- Flag name: `feature_copilot_export`
- Default: `true` (ship directly)
- Enable for: All users

### 9.2 Rollout Phases
1. **Internal testing**: 1 day
2. **Beta users**: N/A
3. **General availability**: Immediately after merge

---

## 10. Definition of Done

- [ ] All acceptance criteria met
- [ ] All tests passing
- [ ] Code reviewed and approved
- [ ] Documentation updated
- [ ] No TypeScript errors
- [ ] No ESLint warnings
- [ ] Accessibility tested
- [ ] Performance acceptable
- [ ] Manual testing with GitHub Copilot
- [ ] PR merged to main

---

## 11. References

- [GitHub Copilot Instructions Documentation](https://docs.github.com/en/copilot/customizing-copilot)
- [GitHub Copilot Coding Agent](https://docs.github.com/en/copilot/using-github-copilot/using-copilot-coding-agent)
- Research: WRAP format (What, Requirements, Actual files, Patterns) is the recommended structure

---

## 12. Changelog

| Date | Author | Change |
|------|--------|--------|
| 2026-01-17 | Daniel Hernandez | Initial draft |

---

## Output Format Examples

### copilot-instructions.md

```markdown
# [Project Name] - Copilot Instructions

## Project Overview
[Project description from Spec Tree]

## Tech Stack
- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript (strict mode)
- **Styling**: Tailwind CSS
- **State**: Zustand + React Query
- **UI**: shadcn/ui + Radix

## Code Style

### File Organization
- Components in `src/components/` (PascalCase files)
- Hooks in `src/hooks/` (useCamelCase files)
- Types in `src/types/` (PascalCase with interface)
- Utilities in `src/lib/` (camelCase files)

### Conventions
- Use named exports, not default exports
- Use `cn()` for conditional Tailwind classes
- Components should be < 300 lines
- Colocate tests with source files

### Patterns
When creating React components, follow the pattern in `src/components/ui/button.tsx`:
- Props interface defined above component
- Use `forwardRef` for DOM element access
- Use `cn()` for className composition

When creating hooks, follow the pattern in `src/hooks/use-media-query.ts`:
- Return object with named properties
- Handle loading and error states
- Single responsibility principle

## DO NOT
- Use `any` type
- Use `@ts-ignore` or `@ts-nocheck`
- Use inline styles
- Import from node_modules directly (use barrel exports)
- Create circular dependencies

## Testing
- Unit tests with Vitest
- Component tests with React Testing Library
- E2E tests with Playwright
- Visual regression with Chromatic
```

### WRAP Issue Format

```markdown
## What
Implement a DateRangePicker component that allows users to filter orders by date range, with support for preset options (Today, Last 7 days, Last 30 days) and custom date selection.

## Requirements
- [ ] Display trigger button showing current selection or "Select dates"
- [ ] Provide preset options: Today, Last 7 days, Last 30 days, This month
- [ ] Support custom date range selection via dual calendar
- [ ] Validate that end date >= start date
- [ ] Sync selection with URL parameters for shareable links
- [ ] Persist last used filter in localStorage
- [ ] Keyboard navigable (Tab, Enter, Escape)
- [ ] Screen reader accessible with ARIA labels
- [ ] Support dark mode via CSS variables
- [ ] Tests: unit tests for date logic, integration test for component

## Actual files
- `src/components/orders/DateRangePicker.tsx` - New component (create)
- `src/components/orders/DateRangePicker.test.tsx` - Unit tests (create)
- `src/hooks/useDateFilter.ts` - Filter state management (create)
- `src/pages/orders/index.tsx` - Integration point (modify)
- `src/types/orders.ts` - DateRange type (modify)

## Patterns
Follow the component pattern established in `src/components/ui/calendar.tsx`:
- Use `@radix-ui/react-popover` for dropdown behavior
- Use `date-fns` for date manipulation
- Use `cn()` utility for conditional Tailwind classes

Follow the hook pattern in `src/hooks/use-media-query.ts`:
- Return object with named values
- Handle edge cases explicitly

Use the existing `Button` component from `src/components/ui/button.tsx` for the trigger.
```

---

## AI Agent Export Format

<details>
<summary>Click to expand AI-ready specification</summary>

```json
{
  "specVersion": "1.0",
  "generatedBy": "SpecTree",
  "feature": {
    "id": "F2.1.5",
    "title": "GitHub Copilot Export",
    "type": "frontend",
    "context": {
      "project": "Spec Tree",
      "phase": 2,
      "techStack": ["Next.js 14", "TypeScript", "Tailwind"],
      "existingPatterns": "components/spec-tree/lib/export/"
    },
    "specification": {
      "userStory": "As a developer using GitHub Copilot, I want to export my specifications as Copilot-compatible formats, so that Copilot can autonomously implement tasks.",
      "acceptanceCriteria": [
        "Export project as copilot-instructions.md",
        "Export tasks as WRAP format issues",
        "WRAP includes What, Requirements, Actual files, Patterns",
        "Support bulk export of multiple tasks",
        "Copy to clipboard functionality"
      ],
      "filesAffected": [
        "components/spec-tree/lib/export/copilot-export.ts",
        "components/spec-tree/components/export/CopilotExportButton.tsx",
        "components/spec-tree/components/export/CopilotExportDialog.tsx"
      ],
      "testRequirements": [
        "Unit tests for WRAP generation",
        "Unit tests for instructions generation",
        "E2E test for export flow"
      ]
    },
    "constraints": {
      "mustUse": ["existing shadcn components"],
      "mustNotUse": ["external API calls"],
      "performanceTarget": "Export in <2 seconds"
    }
  }
}
```

</details>
