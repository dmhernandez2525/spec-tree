# F3.1.1 - REST API

## Overview
Public REST API with API key authentication, rate limiting, OpenAPI documentation, and usage analytics.

## Architecture

### API Key Authentication
- Keys are generated with `sk_live_` prefix + 40 random characters
- Stored as SHA-256 hash in Strapi (`public-api-key` content type)
- Authenticated via `Authorization: Bearer sk_live_...` header
- Keys have tiers (free/starter/pro/enterprise) with different rate limits

### Rate Limiting
- In-memory sliding window counter per API key
- Tier-based limits (free: 10/min, starter: 30/min, pro: 60/min, enterprise: 120/min)
- Standard headers: `X-RateLimit-Limit`, `X-RateLimit-Remaining`, `X-RateLimit-Reset`
- 429 responses with `Retry-After` header when exceeded

### API Versioning
- All endpoints prefixed with `/api/v1/`
- `X-API-Version` header in all responses
- `X-Request-Id` header for request tracing

### CORS
- Per-key CORS origin configuration
- Supports exact match, wildcard (`*`), and subdomain wildcards (`*.example.com`)
- Preflight (OPTIONS) handling in middleware

## Endpoints

| Method | Path | Description |
|--------|------|-------------|
| GET | /api/v1/specs | List specifications |
| POST | /api/v1/specs | Create specification |
| GET | /api/v1/specs/:id | Get specification |
| PUT | /api/v1/specs/:id | Update specification |
| DELETE | /api/v1/specs/:id | Delete specification |
| GET | /api/v1/specs/:id/epics | List epics |
| POST | /api/v1/specs/:id/epics | Create epic |
| GET | /api/v1/specs/:id/epics/:epicId | Get epic |
| PUT | /api/v1/specs/:id/epics/:epicId | Update epic |
| DELETE | /api/v1/specs/:id/epics/:epicId | Delete epic |
| GET | /api/v1/specs/:id/epics/:epicId/features | List features |
| POST | /api/v1/specs/:id/epics/:epicId/features | Create feature |
| GET | /api/v1/specs/:id/epics/:epicId/features/:featureId | Get feature |
| PUT | /api/v1/specs/:id/epics/:epicId/features/:featureId | Update feature |
| DELETE | /api/v1/specs/:id/epics/:epicId/features/:featureId | Delete feature |
| GET | /api/v1/docs | OpenAPI specification (public) |
| GET | /api/v1/keys | List API keys (session auth) |
| POST | /api/v1/keys | Create API key (session auth) |

## Response Formats

### Success (single)
```json
{
  "data": { ... },
  "meta": { "apiVersion": "v1", "requestId": "req_..." }
}
```

### Success (list)
```json
{
  "data": [ ... ],
  "meta": {
    "apiVersion": "v1",
    "requestId": "req_...",
    "pagination": { "page": 1, "pageSize": 25, "pageCount": 4, "total": 100 }
  }
}
```

### Error
```json
{
  "error": {
    "code": "NOT_FOUND",
    "message": "Specification not found",
    "status": 404
  }
}
```

## Files

### Utilities
- `Client/lib/api/api-auth.ts` - API key authentication
- `Client/lib/api/api-middleware.ts` - Shared middleware (auth + rate limit + CORS + logging)
- `Client/lib/api/api-response.ts` - Response builders and pagination helpers
- `Client/lib/api/api-logger.ts` - Request/response logging with sensitive field redaction
- `Client/lib/api/rate-limiter.ts` - In-memory sliding window rate limiter
- `Client/lib/api/openapi-spec.ts` - OpenAPI 3.0 specification

### API Routes
- `Client/app/api/v1/specs/route.ts` - Specs list/create
- `Client/app/api/v1/specs/[specId]/route.ts` - Spec get/update/delete
- `Client/app/api/v1/specs/[specId]/epics/route.ts` - Epics list/create
- `Client/app/api/v1/specs/[specId]/epics/[epicId]/route.ts` - Epic get/update/delete
- `Client/app/api/v1/specs/[specId]/epics/[epicId]/features/route.ts` - Features list/create
- `Client/app/api/v1/specs/[specId]/epics/[epicId]/features/[featureId]/route.ts` - Feature CRUD
- `Client/app/api/v1/docs/route.ts` - OpenAPI spec endpoint
- `Client/app/api/v1/keys/route.ts` - API key management

### Redux
- `Client/lib/store/rest-api-slice.ts` - API key management state

### UI Components
- `Client/components/dashboard/api/ApiKeyList.tsx` - Key management UI
- `Client/components/dashboard/api/ApiUsageDashboard.tsx` - Usage analytics
- `Client/components/dashboard/api/ApiDocsViewer.tsx` - Interactive API docs viewer
- `Client/components/dashboard/api/ApiManagementPanel.tsx` - Combined management panel

### Strapi
- `Server/src/api/public-api-key/` - Public API key content type
